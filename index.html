<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Hubs Capacity Estimator</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Event Hubs Capacity Estimator</h1>
  </header>
  <div class="container">
    <section>
      <h2>About This Tool</h2>
      <p>
        This tool helps estimate the number of partitions and Capacity Units (CUs) needed for an Azure Event Hubs cluster based on your ingress requirements.
      </p>
      <p>
        Please refer to the <a href="https://github.com/github/observability/blob/main/docs/log-storage/octokus-glb-federated-kusto-cluster/how-to-calculate-event-hubs-capacity-for-glb-federated-kusto-cluster.md">our docs</a> for more information.
      </p>
    </section>
  </div>

  <div class="container">
    <section>
      <h2>Ideal Number of Partitions Needed Today</h2>
      <p>
        The ideal ingress for a given Event Hub topic is <strong>1MB/s</strong>.<br>
      </p>
      <p>To determine your max number of MB/s in the past month, view <a href="https://app.datadoghq.com/notebook/12955404?cell_id=z1gmwj4b&tpl_var_event_hub_namespace=octolog-event-hubs-%2A&tpl_var_topic=glb">this</a> graph and select your Event Hub cluster name and topic</p>
      <p>Then, choose the <strong>maximum TiB</strong> value from the past month.</p>
      <p>From there, we will calculate the max MB/sec observed on that day, and use it to determine the number of partitions needed.</p>
      <label for="ingress">Highest total TiB/day of Event Hub ingress:</label>
      <input type="number" id="ingress" min="0" step="any" placeholder="Enter TiB/day">
      <br><br>
      <label for="numTopics">Number of topics to shard over:</label>
      <input type="number" id="numTopics" min="1" value="1">
      <br><br>
      <button id="estimateBtn">Estimate Partitions</button>
      <div id="result" style="margin-top: 1em;"></div>
    </section>
  </div>

  <div class="container">
    <section>
      <h2>Ideal Number of CUs Needed Today</h2>
      <p>
        The number of Capacity Units (CUs) you need is based on your total ingress requirements.<br>
        Total ingress is calculated as required partition count × <strong>1 MB/sec</strong> (per partition).<br>
        Each CU supports <strong>150 MB/sec</strong> ingress, so the number of CUs needed is:<br>
        <code>Total Ingress Needed / 150 MB/sec</code>
      </p>
      <p>
        A <strong>dedicated tier</strong> Event Hubs allows for up to 1024 partitions per topic and up to 10 CUs per cluster.<br>
        A <strong>custom-built cluster</strong> allows for up to 1008 partitions per topic and up to 36 CUs per cluster.
      </p>
      <label for="tier">Select Event Hubs Tier:</label>
      <select id="tier">
        <option value="dedicated">Dedicated</option>
        <option value="custom">Custom</option>
      </select>
      <br><br>
      <label for="numClusters">Number of Clusters:</label>
      <input type="number" id="numClusters" min="1" value="1">
      <br><br>
      <label for="cusPerCluster">Number of CUs per Cluster:</label>
      <input type="number" id="cusPerCluster" min="1" value="10">
      <br><br>
      <label for="maxPartitionsPerTopic">Num partitions per topic (per cluster):</label>
      <input type="number" id="maxPartitionsPerTopic" min="1" value="1024">
      <button id="cuBtn">Estimate CUs</button>
      <div id="cuResult" style="margin-top: 1em;"></div>
      <div id="cuConclusion" style="margin-top: 1em; font-weight: bold;"></div>
    </section>
  </div>

  <div class="container">
    <section>
      <h2>Current Capacity Evaluation</h2>
      <table id="capacity-table">
        <thead>
          <tr>
            <th>Current Req. Partition Count</th>
            <th>Current Max Partition Count</th>
            <th>Current Req. CU Count</th>
            <th>Current Max CU Count</th>
          </tr>
        </thead>
        <tbody>
          <!-- Table row inserted by JS -->
        </tbody>
      </table>
    </section>
  </div>

  <div class="container">
    <section>
      <h2>6 Month Projected Partition Requirements</h2>
      <p>
        GLB logs have grown <a href="https://app.datadoghq.com/s/59fe6c40c/p2w-g5h-wig" target="_blank">10% each month from April to October</a>.
        So, let's assume that rate of growth will continue, and we can predict the total number of partitions needs like this:
        <code>current_num_partitions_needed * 1.1</code>.
      </p>
      <table id="projection-table">
        <thead>
          <tr>
            <th>Month</th>
            <th>Est. Num Partitions Needed (per topic)</th>
            <th>% Partition Capacity Remaining</th>
            <th>Projected Required CUs</th>
            <th>% CU Capacity Remaining</th>
          </tr>
        </thead>
        <tbody>
          <!-- Table rows inserted by JS -->
        </tbody>
      </table>
    </section>
  </div>

  <script src="script.js"></script>
</body>
</html>